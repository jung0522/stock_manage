<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/base}">
<head>
    <title>주문 상세</title>
</head>
<body>
    <div layout:fragment="content" class="container mt-4">
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2>주문 상세 정보</h2>
                <a th:href="@{/buyer/orders}" class="btn btn-secondary">목록으로</a>
            </div>

            <!-- 발주 기본 정보 -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5>주문 정보</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <table class="table table-borderless">
                                <tr>
                                    <th width="120">주문번호:</th>
                                    <td th:text="${order.orderNumber}"></td>
                                </tr>
                                <tr>
                                    <th>주문일:</th>
                                    <td th:text="${#temporals.format(order.orderDate, 'yyyy-MM-dd HH:mm')}"></td>
                                </tr>
                                <tr>
                                    <th>상태:</th>
                                    <td>
                                        <span class="badge bg-success" th:if="${order.status.name() == 'APPROVED'}">승인됨</span>
                                        <span class="badge bg-warning" th:if="${order.status.name() == 'PENDING'}">대기중</span>
                                    </td>
                                </tr>
                                <tr>
                                    <th>배송상태:</th>
                                    <td>
                                        <span class="badge bg-primary" th:if="${order.deliveryStatus.name() == 'ORDER_COMPLETED'}">주문완료</span>
                                        <span class="badge bg-success" th:if="${order.deliveryStatus.name() == 'DELIVERY_COMPLETED'}">배송완료</span>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div class="col-md-6">
                            <table class="table table-borderless">
                                <tr>
                                    <th width="120">총 금액:</th>
                                    <td th:text="${#numbers.formatDecimal(order.totalAmount, 0, 'COMMA', 0, 'POINT')} + '원'"></td>
                                </tr>
                                <tr>
                                    <th>할인율:</th>
                                    <td th:text="${order.discountRate} + '%'"></td>
                                </tr>
                                <tr>
                                    <th>할인 금액:</th>
                                    <td class="text-danger" th:text="'-' + ${#numbers.formatDecimal(order.discountAmount, 0, 'COMMA', 0, 'POINT')} + '원'"></td>
                                </tr>
                                <tr>
                                    <th>최종 금액:</th>
                                    <td class="fw-bold text-primary" th:text="${#numbers.formatDecimal(order.finalAmount, 0, 'COMMA', 0, 'POINT')} + '원'"></td>
                                </tr>
                            </table>
                        </div>
                    </div>

                    <div th:if="${order.notes}" class="mt-3">
                        <strong>비고:</strong>
                        <p th:text="${order.notes}" class="mt-2"></p>
                    </div>
                </div>
            </div>

            <!-- 발주 상품 목록 -->
            <div class="card">
                <div class="card-header">
                    <h5>주문 상품 목록</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>상품명</th>
                                    <th>카테고리</th>
                                    <th>단가</th>
                                    <th>수량</th>
                                    <th>할인율</th>
                                    <th>할인액</th>
                                    <th>합계</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr th:each="item : ${order.orderItems}">
                                    <td th:text="${item.productName}"></td>
                                    <td th:text="${item.categoryName}"></td>
                                    <td th:text="${#numbers.formatDecimal(item.unitPrice, 0, 'COMMA', 0, 'POINT')} + '원'"></td>
                                    <td th:text="${item.quantity} + '개'"></td>
                                    <td th:text="${item.discountRate} + '%'"></td>
                                    <td class="text-danger" th:text="'-' + ${#numbers.formatDecimal(item.discountAmount, 0, 'COMMA', 0, 'POINT')} + '원'"></td>
                                    <td class="fw-bold" th:text="${#numbers.formatDecimal(item.lineTotal, 0, 'COMMA', 0, 'POINT')} + '원'"></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>
</body>
</html>